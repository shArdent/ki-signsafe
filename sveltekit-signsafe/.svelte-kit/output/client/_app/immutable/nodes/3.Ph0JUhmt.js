import{t as y,a as v,b as Q}from"../chunks/D5yI2wqk.js";import{i as fe}from"../chunks/BumpSI4p.js";import{o as be}from"../chunks/DiJJycSe.js";import{p as me,f as E,a as ye,s as n,b as s,m as g,g as a,c as o,r as d,t as F}from"../chunks/MYc6eXHu.js";import{d as he,s as J,e as xe,r as _e}from"../chunks/Vyx9v3T8.js";import{i as k}from"../chunks/DWZY7GPS.js";import{r as we,b as ke,s as Ke}from"../chunks/Bv7EZ9Xw.js";import{T as Se,l as Le,a as je,s as X,t as p,b as Y,c as Ae,f as Fe}from"../chunks/BVR6nl7Y.js";import{g as M}from"../chunks/DoHTRtBx.js";const Ie=()=>{const I=document.getElementById("key-file-input");I&&I.click()};var Ce=y('<p class="mt-10 text-center text-gray-600">Checking session...</p>'),Ue=y('<p class="text-sm text-red-600"> </p>'),De=y('<p class="text-sm text-gray-600">File terpilih: <span class="font-medium"> </span></p> <button type="button" class="w-full rounded-lg bg-blue-600 py-2 text-white transition hover:bg-blue-700 disabled:opacity-50"><!></button>',1),Je=y('<p class="text-sm text-red-600"> </p>'),Oe=()=>{M("/")},Re=y('<div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40"><div class="w-[90%] max-w-lg rounded-xl bg-white p-6 shadow-lg"><h2 class="mb-4 text-lg font-semibold text-gray-800">Private Key Anda</h2> <p class="mb-2 text-sm text-gray-600">Simpan key ini secara aman. Anda hanya dapat mengunduhnya sekali.</p> <textarea class="h-40 w-full rounded border bg-gray-50 p-2 text-xs" readonly=""></textarea> <div class="mt-4 flex justify-end space-x-3"><button class="rounded bg-blue-600 px-4 py-2 text-white hover:bg-blue-700">Download</button> <button class="rounded bg-gray-300 px-4 py-2 text-gray-800 hover:bg-gray-400">Tutup</button></div></div></div>'),Ne=y('<div class="flex min-h-screen flex-col items-center justify-center bg-gray-50 px-4"><div class="w-full max-w-md rounded-xl bg-white p-8 shadow-md"><h1 class="mb-4 text-2xl font-bold text-gray-700">Registrasi Akun</h1> <form class="space-y-4"><input class="w-full rounded-lg border px-4 py-2 focus:ring-2 focus:ring-blue-500 focus:outline-none" type="text" placeholder="Username" required> <button class="w-full rounded-lg bg-blue-600 py-2 text-white transition hover:bg-blue-700 disabled:opacity-50" type="submit"> </button> <!></form> <div class="my-6 flex items-center"><div class="flex-grow border-t border-gray-300"></div> <span class="mx-4 text-gray-500">ATAU</span> <div class="flex-grow border-t border-gray-300"></div></div> <div class="space-y-4"><h2 class="mb-2 text-xl font-bold text-gray-700">Login dengan File Kunci</h2> <input type="file" id="key-file-input" accept=".json" class="hidden"> <button type="button" class="flex w-full items-center justify-center rounded-lg bg-gray-600 py-2 text-white transition hover:bg-gray-700 disabled:opacity-50"><svg xmlns="http://www.w3.org/2000/svg" class="mr-2 h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg> Unggah File Kunci</button> <!> <!></div></div></div> <!>',1),Te=y("<!> <!>",1);function Ve(I,Z){me(Z,!1);let C=g(""),O=g(""),U=g(!1),P=g(!1),W=g(""),K=null,h=null,S=g(null),L=g(!1),c=g("");const $=async t=>{t.preventDefault(),s(U,!0),s(O,"");try{const{privateKey:e,publicKey:f}=await crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["sign","verify"]),b=await crypto.subtle.exportKey("jwk",f),l=await crypto.subtle.exportKey("jwk",e),j=JSON.stringify(b),x={name:a(C),public_key:j},{data:A}=await je.post("/auth/register",x);K={userId:A.id,name:A.name,privateKey:l},await X(a(C),l,A.id),s(W,JSON.stringify(l,null,2)),s(P,!0)}catch(e){if(console.log(e),e&&e.status==409){p.error("Akun dengan username tersebut sudah ada");return}else{p.error("Server bermasalah coba lagi nanti");return}}finally{s(U,!1)}},ee=()=>{if(!K){p.error("Tidak ada data kunci untuk diunduh.");return}const t=JSON.stringify(K,null,2),e=`${K.name}-keys-${K.userId.substring(0,8)}.json`,f=new Blob([t],{type:"application/json"}),b=URL.createObjectURL(f),l=document.createElement("a");l.href=b,l.download=e,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(b),p.success("File kunci Anda telah diunduh. Simpan di tempat yang aman!")},te=t=>{const e=t.target;e.files&&e.files.length>0?(h=e.files[0],s(S,h.name),s(c,"")):(h=null,s(S,null))},ae=async()=>{if(!h){p.error("Harap pilih file kunci terlebih dahulu.");return}s(L,!0),s(c,"");try{const t=await h.text(),e=JSON.parse(t);if(!e.userId||!e.privateKey||typeof e.privateKey!="object"||!e.privateKey.kty){p.error("Format file kunci tidak valid. Pastikan berisi userId dan privateKey.");return}await X(e.name,e.privateKey,e.userId),p.success(`Login berhasil untuk user: ${e.name||e.userId}`),M("/")}catch(t){console.error("Login with file error:",t),t instanceof SyntaxError?(s(c,"File yang diunggah bukan JSON yang valid."),p.error(a(c))):t.status===401||t.status===403?(s(c,"Kunci tidak valid atau tidak cocok dengan akun."),p.error(a(c))):(s(c,"Gagal login dengan file. Coba lagi nanti."),p.error(a(c)))}finally{s(L,!1),h=null,s(S,null)}};let z=g(!0);be(async()=>{await Le()?M("/"):s(z,!1)}),fe();var B=Te(),H=E(B);{var re=t=>{var e=Ce();v(t,e)},se=t=>{var e=Ne(),f=E(e),b=o(f),l=n(o(b),2),j=o(l);we(j);var x=n(j,2),A=o(x,!0);d(x);var ne=n(x,2);{var le=r=>{var i=Ue(),u=o(i,!0);d(i),F(()=>J(u,a(O))),v(r,i)};k(ne,r=>{a(O)&&r(le)})}d(l);var q=n(l,4),G=n(o(q),2);G.__change=te;var R=n(G,2);R.__click=[Ie];var V=n(R,2);{var oe=r=>{var i=De(),u=E(i),_=n(o(u)),D=o(_,!0);d(_),d(u);var m=n(u,2);m.__click=ae;var N=o(m);{var ve=w=>{var T=Q("Memproses Login...");v(w,T)},ge=w=>{var T=Q("Login");v(w,T)};k(N,w=>{a(L)?w(ve):w(ge,!1)})}d(m),F(()=>{J(D,a(S)),m.disabled=a(L)}),v(r,i)};k(V,r=>{a(S)&&r(oe)})}var de=n(V,2);{var ue=r=>{var i=Je(),u=o(i,!0);d(i),F(()=>J(u,a(c))),v(r,i)};k(de,r=>{a(c)&&r(ue)})}d(q),d(b),d(f);var ce=n(f,2);{var pe=r=>{var i=Re(),u=o(i),_=n(o(u),4);_e(_);var D=n(_,2),m=o(D);m.__click=ee;var N=n(m,2);N.__click=[Oe],d(D),d(u),d(i),F(()=>Ke(_,a(W))),Y(3,u,()=>Ae),Y(3,i,()=>Fe),v(r,i)};k(ce,r=>{a(P)&&r(pe)})}F(()=>{x.disabled=a(U),J(A,a(U)?"Memproses...":"Daftar"),R.disabled=a(L)}),xe("submit",l,$),ke(j,()=>a(C),r=>s(C,r)),v(t,e)};k(H,t=>{a(z)?t(re):t(se,!1)})}var ie=n(H,2);Se(ie,{}),v(I,B),ye()}he(["change","click"]);export{Ve as component};
